<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>新增员工</title>
    <!-- 引入样式 -->
    <link rel="stylesheet" href="../../plugins/element-ui/index.css" />
</head>
<body>
<div id="add">
    <div>
        <el-form
                ref="ruleForm"
                labelwidth="60px"
                :inline="true"
                style="margin-top: 60px">
                <div>
                <el-form-item label="账号" prop="userName" >
                    <el-input type="text"
                              v-model="ruleForm.userName"
                              style="width: 200px;"
                              placeholder="请输入账号"
                              maxlength="20">
                    </el-input>
                </el-form-item>
                <el-form-item label="密码" prop="password" >
                    <el-input type="text"
                              v-model="ruleForm.password"
                              style="width: 200px;"
                              placeholder="请输入密码"
                              maxlength="20">
                    </el-input>
                </el-form-item>
                </div>
                <div>
                    <el-form-item label="电话" prop="phone">
                    <el-input type="number"
                              v-model="ruleForm.phone"
                              style="width: 200px"
                              placeholder="请输入电话号码">
                    </el-input>
                </el-form-item>
            </div>


            <div>
                <el-form-item label="地址" prop="address" >
                    <el-input
                            type="textarea"
                            v-model="ruleForm.address"
                            style="width: 400px;"
                            placeholder="请输入地址"
                            :rows="3"  >
                    </el-input>
                </el-form-item>
            </div>

            <div>
                <el-form-item style="margin-left: 60px">
                    <el-button
                            type="primary"
                            @click="submitForm">创建
                    </el-button>
                    <el-button
                            style="margin-left: 20px"
                            @click="cancle">
                        取消
                    </el-button>
                </el-form-item>
            </div>

        </el-form>

    </div>
</div>

    <script src="../../plugins/vue/vue.js"></script>
    <!-- 引入组件库 -->
    <script src="../../plugins/element-ui/index.js"></script>
    <!-- 引入axios -->
    <script src="../../plugins/axios/axios.min.js"></script>
    <script src="../../js/request.js"></script>
    <script src="../../js/index.js"></script>
    <script src="../../api/tea.js"></script>
    <script src="../../api/employee.js"></script>

<script>
    new Vue({
        el: '#add',
        data(){
            return{
                id: '',
                visible: true,
                imageUrl: '',
                ruleForm: {
                    userName: '',
                    password: '',
                    phone: '',
                    address: ''
                },
                actionType: '',
            }
        },
        created() {
            this.id = requestUrlParam('id')
            this.actionType = this.id ? 'edit' : 'add'
            if (this.id) {
                this.init()
            }
        },
        methods:{
            async init () {
                let ids ={
                    id: this.id
                }
                queryEmployeeById(ids).then(res => {
                    if (String(res.code) === '1') {
                        this.ruleForm = { ...res.data }
                    } else {
                        this.$message.error(res.msg || '操作失败')
                    }
                })
            },
            handleRemove(file, fileList) {
                console.log(file, fileList)
            },
            handlePictureCardPreview(file) {

            },
            handleAvatarSuccess(response,file,fileList){
                this.ruleForm.image = response
            },
            cancle(){
                window.location.href = 'list.html'
            },
            submitForm(){
                let params = this.ruleForm
                if (this.actionType == 'add') {
                    addEmployee(params).then(res => {
                        if (res.code === 1) {
                            this.$message.success('添加成功')
                            this.goBack()
                        }
                        else{
                            this.$message.error(res.msg)
                        }
                    })
                }
                else {
                    updateEmployee(params).then(res => {
                        if (res.code === 1) {
                            this.$message.success('修改成功！')
                            window.location.href = 'list.html'
                        } else {
                            this.$message.error(res.msg || '操作失败')
                        }
                    }).catch(err => {
                        this.$message.error('请求出错了：' + err)
                    })
                }
            },
            goBack(){
                window.parent.menuHandle({
                    id: '0',
                    url: '/backend/page/employee/list.html',
                    name: '员工管理'
                },false)
            }
        }
    })
</script>
</body>
</html>